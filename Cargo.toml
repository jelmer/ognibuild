[package]
name = "ognibuild"
version = { workspace = true }
authors = [ "Jelmer Vernooij <jelmer@jelmer.uk>"]
edition = "2021"
license = "GPL-2.0+"
description = "Detect and run any build system"
repository = "https://github.com/jelmer/ognibuild.git"
homepage = "https://github.com/jelmer/ognibuild"

[dependencies]
axum = { version = "0.7", optional = true, features = ["json", "http2", "tokio"] }
breezyshim = { workspace = true }
#buildlog-consultant = "0.0.39"
buildlog-consultant = { git = "https://github.com/jelmer/buildlog-consultant" }
chrono = "0.4.38"
clap = { version = "4", features = ["derive"], optional = true }
debian-changelog = { version = "0.1", optional = true }
debian-control = { version = "0.1.25", optional = true }
debversion = { version = "0.4", optional = true }
env_logger = { version = "0.10.0", optional = true }
flate2 = { version = "1", optional = true }
fs_extra = "1.3.0"
lazy_static = "1.5.0"
libc = "0.2.148"
log = "0.4.20"
lz4_flex = { version = "0.11.3", optional = true }
lzma-rs = { version = "0.3.0", optional = true }
maplit = "1.0.2"
nix = { version = "0.29.0", features = ["user"] }
percent-encoding = "2.3.1"
pyo3 = { workspace = true }
rand = "0.8.5"
regex = "1.10.6"
reqwest = { version = "0.12.7", optional = true, features = ["blocking", "json"] }
semver = "1.0.23"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
shlex = "1.3.0"
sqlx = { version = "0.8.1", optional = true, features = ["postgres", "runtime-tokio-native-tls"] }
stackdriver_logger = { version = "0.8.2", optional = true }
tempfile = "3.11.0"
tokio = { version = "1", features = ["full"], optional = true }
url = "2.5.1"
whoami = { version = "1.5.1", default-features = false }

[features]
default = ["debian", "cli", "udd"]
debian = ["dep:debian-changelog", "dep:debversion", "dep:debian-control", "dep:flate2", "dep:lzma-rs", "dep:lz4_flex", "dep:reqwest", "breezyshim/debian"]
cli = ["dep:clap", "dep:env_logger"]
sqlx = ["dep:sqlx"]
udd = ["dep:sqlx", "dep:tokio"]
dep-server = ["dep:axum", "dep:tokio"]

[workspace.dependencies]
pyo3 = "0.22"
breezyshim = "0.1"

[workspace]
members = ["ognibuild-py"]

[workspace.package]
version = "0.0.24"

[dev-dependencies]
lazy_static = "1.5.0"

[[bin]]
name = "ognibuild-deb"
path = "src/bin/ognibuild-deb.rs"
required-features = ["cli", "debian"]

[[bin]]
name = "apt-file-search"
path = "src/bin/apt-file-search.rs"
required-features = ["cli", "debian"]

[[bin]]
name = "dep-server"
path = "src/bin/dep-server.rs"
required-features = ["dep-server", "cli", "debian"]
